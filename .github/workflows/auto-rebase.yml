name: Auto update PR branch
on:
  push:
    branches: [master]

jobs:
  get-latest-commit:
    runs-on: ubuntu-latest
    steps:
      - name: View context attributes
        uses: actions/github-script@v4
        with:
          result-encoding: string
          script: |
            console.log(context)
            return context.payload.head_commit.message

  log:
    needs: get-latest-commit
    runs-on: ubuntu-latest
    steps:
      - run: echo "${{needs.get-latest-commit.outputs.result}}"

  auto-update:
    needs: get-latest-commit
    if: "contains(needs.get-latest-commit.outputs.result, 'ci: version bump to')"
    runs-on: ubuntu-latest
    steps:
      - uses: docker://chinthakagodawita/autoupdate-action:v1
        env:
          GITHUB_TOKEN: ${{ secrets.ADMIN_ACCESS_TOKEN }}
          PR_FILTER: 'labelled'
          PR_LABELS: 'ready-for-qa, qa-approved'
